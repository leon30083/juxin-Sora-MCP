# 聚鑫 MCP 服务器使用说明

## 功能概述

聚鑫 MCP 服务器提供了以下功能：

1. **视频生成** - 使用 Sora-2 模型生成视频
2. **批量任务管理** - 支持并发创建和查询多个视频任务
3. **任务跟踪** - 自动记录所有任务状态和进度
4. **角色视频** - 支持从视频创建角色并使用角色生成视频

## MCP 工具列表

### 1. create_video
创建视频生成任务

**参数：**
- `prompt` (必需): 视频生成的提示词
- `orientation` (可选): 视频方向，默认 "landscape" (横屏16:9)
- `size` (可选): 视频尺寸，默认 "small" (720p)
- `duration` (可选): 视频时长，默认 15 秒
- `watermark` (可选): 是否添加水印，默认 false
- `private` (可选): 是否隐藏视频，默认 true
- `images` (可选): 参考图片URL数组
- `character_url` (可选): 角色视频URL（角色视频必需）
- `character_timestamps` (可选): 角色时间戳（角色视频必需）
- `wait_for_completion` (可选): 是否等待完成，默认 false

### 2. create_character
从视频创建角色

**参数：**
- `url` (必需): 包含角色的视频URL
- `timestamps` (必需): 角色出现的时间段，格式 "1,2"

### 3. query_video_status
查询单个视频任务状态

**参数：**
- `task_id` (必需): 任务ID

### 4. query_all_videos
批量查询多个视频任务状态（最多20个）

**参数：**
- `task_ids` (必需): 任务ID数组

### 5. list_tasks
列出所有任务和统计信息

**参数：**
- `limit` (可选): 返回任务数量，默认10
- `status` (可选): 过滤状态，默认 "all"

## 测试脚本

### 基本测试
```bash
# 测试普通视频创建
node test-simple-video.js

# 测试角色创建
node test-character.js

# 测试提供的角色
node test-provided-characters.js

# 查询单个任务
node query-single-task.js <task-id>

# 列出所有任务
node list-tasks.js
```

## 当前状态

### ✅ 已实现功能
- [x] 基础视频创建 API 集成
- [x] 任务状态查询
- [x] 批量任务管理
- [x] 角色创建功能
- [x] 角色视频生成
- [x] 任务持久化存储

### ⚠️ 注意事项
当前 API 返回错误："No available channels for model veo2-fast in group 限时特价"

这可能是由于：
1. API 服务暂时不可用
2. 当前套餐组的配额已用完
3. 需要使用不同的 API 端点或认证方式

### 建议解决方案
1. 联系 API 提供商确认服务状态
2. 检查是否需要升级套餐或更换组别
3. 尝试使用不同的 API Key

## 使用示例

### 创建普通视频
```json
{
  "name": "create_video",
  "arguments": {
    "prompt": "一只猫在樱花树下散步",
    "orientation": "landscape",
    "size": "small",
    "duration": 15,
    "watermark": false,
    "private": true
  }
}
```

### 创建角色
```json
{
  "name": "create_character",
  "arguments": {
    "url": "https://example.com/video.mp4",
    "timestamps": "1,3"
  }
}
```

### 创建角色视频
```json
{
  "name": "create_video",
  "arguments": {
    "prompt": "@jasvwqpvt.hanblueher 在战场上英勇作战",
    "orientation": "landscape",
    "size": "small",
    "duration": 15,
    "watermark": false,
    "private": true
  }
}
```

## 环境变量

运行 MCP 服务器前需要设置：
```bash
export JUXIN_API_KEY="your-api-key"
export JUXIN_API_BASE_URL="https://api.jxincm.cn"  # 可选，默认值
export MCP_SERVER_NAME="juxin-mcp-server"          # 可选
export MCP_SERVER_VERSION="1.0.0"                   # 可选
```

## 安装和运行

```bash
# 安装依赖
npm install

# 构建 TypeScript
npm run build

# 运行 MCP 服务器
node dist/index.js

# 或使用 Claude Code 配置
# 将此 MCP 服务器添加到 Claude Code 配置文件
```

## 故障排除

### 常见错误

1. **"JUXIN_API_KEY 环境变量未设置"**
   - 解决：设置环境变量

2. **"No available channels for model veo2-fast"**
   - 解决：联系 API 提供商

3. **TypeScript 编译错误**
   - 解决：运行 `npm run build` 检查

4. **任务 ID 无效**
   - 解决：使用 `list_tasks` 查看所有任务

### 日志输出

MCP 服务器将日志输出到 stderr，包括：
- 任务创建和更新
- API 错误
- 状态更新

## 下一步

1. 等待 API 服务恢复
2. 测试角色视频功能
3. 添加更多错误处理
4. 实现自动重试机制