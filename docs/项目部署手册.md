# 《项目部署手册》

## 环境与依赖
- 操作系统：Windows 11（建议）
- Node.js：18+（用于运行本地 MCP Server）
- 网络与鉴权：
  - `API_BASE_URL`：`https://api.jxincm.cn`
  - `API_KEY`：你的聚鑫密钥
  - `API_KEY_HEADER`（可选）：默认 `Authorization`（Bearer）

## 本地服务器（stdio）
- 在仓库根目录运行：`node mcp-server.js`
- 说明：该脚本以 JSON-RPC 2.0 通过标准输入输出提供 MCP 工具能力

## 客户端安装（自动启动，无需手动运行）
- 在支持 MCP 的客户端配置文件中添加：
```
{
  "mcpServers": {
    "sora2-mcp": {
      "command": "node",
      "args": [
        "e:\\User\\GitHub\\聚鑫mcp\\mcp-server.js"
      ],
      "env": {
        "MCP_MODE": "stdio",
        "API_BASE_URL": "https://api.jxincm.cn",
        "API_KEY": "<YOUR_API_KEY>",
        "API_KEY_HEADER": "Authorization",
        "VIDEO_CREATE_PATH": "/v1/video/create",
        "TASK_STATUS_PATH": "/v1/videos",
        "CHARACTER_CREATE_PATH": "/sora/v1/characters",
        "ASSET_UPLOAD_PATH": "/v1/assets/upload"
      }
    }
  }
}
```
- 客户端会自动启动 MCP Server 并注册工具，无需手动运行脚本

## 工具与默认参数
- `create_character`：`video_url`/`video_base64`，`timestamps`（建议）；素材自动上传至图床
- `generate_video`：`prompt` 原样；默认 `orientation=landscape`（16:9）、`duration=15`
- `get_task_status`：返回 `status`、百分比 `progress` 与 `video_url`
- `generate_and_follow`：一次调用内自动轮询至返回 `video_url`；默认轮询 `6s`，最长 `8min`

## 快速验证（可选）
- 生成：`powershell -ExecutionPolicy Bypass -File tests/quick-generate.ps1`
- 轮询：`powershell -ExecutionPolicy Bypass -File tests/quick-poll.ps1`
- 一键：`powershell -ExecutionPolicy Bypass -File tests/quick-all.ps1`

## 约束与安全
- 禁止提交密钥到仓库，密钥仅通过环境变量或客户端配置注入
- 本地资料目录已加入 `.gitignore`：`开发资料夹-用户存放资料/`

## 故障排查
- 初始化错误：确保 `initialize` 返回 `serverInfo`；使用最新 `mcp-server.js`
- 参数缺失：若接口提示 `size` 或其他必填，直接在客户端工具表单填入
- 队列耗时：默认 2–3 分钟；轮询进度按百分比显示，生成完成返回 `video_url`
